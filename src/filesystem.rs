use crate::{alloc, applications::{assembly, basic, femc}, info, print, println, string::BigString, vec::{BigVec, FileVec}, warnln};

use lazy_static::lazy_static;
use spin::Mutex;

pub struct FileSystem {
    files: FileVec,
    flow: i32
}
impl FileSystem {
    fn _get_item_name(&self, id: u32) -> [u8; 20] {
        self.files.iter()[id as usize].3
    }

    fn print_path(&self, id: u32) {
        let file = self.files.iter()[id as usize];
        if file.1 != -1 {
            self.print_path(file.1 as u32);
            info!("/");
        }
        for byte in file.3 {
            if byte == 0 { break; }
            info!("{}", byte as char);
        }
    }

    pub fn create_file(&mut self, parent: i32, filename: [u8; 20], filetype: u8, data: &str) {
        let data_bytes = data.bytes();

        let address = alloc::alloc(data.bytes().len());

        let mut index = 0;
        for i in data_bytes {
            if address.0 + index > address.1 {
                break;
            }
            alloc::write_byte(address.0 + index, i as usize);
            index += 8;
        }

        self.files.add((self.files.len() as u32, parent, (address.0, address.1, index / 8), filename, filetype));

        print!("Created a new file with path ");
        info!("/");
        self.print_path(self.files.len() as u32 - 1);
        print!("\n");
    }

    pub fn set_flow(&mut self, flow: i32) {
        self.flow = flow;
    }

    // this being a list of 20 is the max amount of files that will be returned, why 20? sounds good to me tbh :3
    pub fn get_file_from_parent(&self, parent: i32) -> [(u32, i32, (usize, usize, usize), [u8; 20], u8); 20] {
        let mut files_returning = [(0, -1, (0, 1, 0), [1; 20], 0); 20];
        let mut files_returning_len = 0;
        for file in self.files.iter() {
            if file.1 == parent && files_returning_len < 20 {
                files_returning[files_returning_len] = file;
                files_returning_len += 1;
            }
        }
        files_returning
    }

    pub fn get_file_from_current_parent(&self) -> [(u32, i32, (usize, usize, usize), [u8; 20], u8); 20] {
        self.get_file_from_parent(self.flow)
    }
}

lazy_static! {
    pub static ref FILESYSTEM: Mutex<FileSystem> = Mutex::new(FileSystem {
        files: FileVec::new(),
        flow: 1
    });
}

pub fn print_current_dir_files() {
    let files_found = FILESYSTEM.lock().get_file_from_current_parent();
    for file in files_found {
        if file.1 == -1 { continue; }
        for char_byte in file.3 {
            if char_byte == 0 { break; }
            print!("{}", char_byte as char);
        }
        print!("\n");
    }
}

pub fn change_flow(name: [u8; 20]) {
    let files = {
        FILESYSTEM.lock().get_file_from_current_parent()
    };
    for file in files {
        if file.3 == name {
            FILESYSTEM.lock().set_flow(file.0 as i32);
        }
    }
}

pub fn find_file(name: [u8; 20]) -> (u32, i32, (usize, usize, usize), [u8; 20], u8) {
    let files = {
        FILESYSTEM.lock().get_file_from_current_parent()
    };
    for file in files {
        let mut file_name: [u8; 20] = [0; 20];
        for byte in file.3.iter().enumerate() {
            if *byte.1 == 61 { break; }
            file_name[byte.0] = *byte.1;
        }
        if name == file_name {
            return file
        }
    }
    println!("This file doesn't seem to exist :c");
    return (0, 0, (0, 0, 0), [0; 20], 0)
}

pub fn create_file(parent: i32, filename: &str, filetype: &str, data: &str) {
    let mut filename_bytes = [0; 20];
    let mut filename_bytes_len = 0;

    let file_type = {
        match filetype {
            "a" => 1,   // assembly
            "b" => 2,   // basic
            "fc" => 3,  // FemC
            _ => 0      // Flow
        }
    };

    let is_flow = filetype.bytes().len() == 0;

    let filename_parsed = filename.bytes();
    for byte in filename_parsed {
        filename_bytes[filename_bytes_len] = byte;
        filename_bytes_len += 1;
    }

    if !is_flow {
        filename_bytes[filename_bytes_len] = 61;
        filename_bytes_len += 1;
        let filetype_parsed = filetype.bytes();
        for byte in filetype_parsed {
            filename_bytes[filename_bytes_len] = byte;
            filename_bytes_len += 1;
        }
    }

    FILESYSTEM.lock().create_file(parent, filename_bytes, file_type, data);
}

pub fn read_file(name: [u8; 20]) {
    let file = find_file(name);
    let file_start = file.2.0;
    let file_size = file.2.2;

    for i in 0..file_size {
        let byte = alloc::read_byte(file_start + i * 8) as u8;
        print!("{}", byte as char);
    }
    print!("\n");
}

pub fn read_image(name: [u8; 20]) -> BigVec {
    let file = find_file(name);
    let file_start = file.2.0;
    let file_size = file.2.2;

    let mut contents = BigVec::new();

    for i in 0..file_size {
        let byte = alloc::read_byte(file_start + i * 8);
        contents.add(byte);
    }

    contents
}

pub fn run_file(name: [u8; 20]) {
    let file = find_file(name);
    let file_start = file.2.0;
    let file_size = file.2.2;
    let file_type = file.4;

    match file_type {
        1 => {
            let mut file_data: BigString = BigString::new();
            for i in 0..file_size {
                let byte = alloc::read_byte(file_start + i * 8) as u8;
                file_data.add(byte);
            }
            assembly::exec(file_data);
        }
        2 => {
            let mut file_data: [u8; 512] = [0; 512];
            for i in 0..file_size {
                if i >= 512 {
                    break;
                }
                let byte = alloc::read_byte(file_start + i * 8) as u8;
                file_data[i] = byte;
            }
            basic::exec(file_data);
        }
        3 => {
            let mut file_data: [u8; 256] = [0; 256];
            for i in 0..file_size {
                if i >= 256 {
                    break;
                }
                let byte = alloc::read_byte(file_start + i * 8) as u8;
                file_data[i] = byte;
            }
            femc::exec(file_data);
        }
        _ => warnln!("Unrecognized file type, I can't run this :C")
    }
}

pub fn install_base_os() {
    println!("Installing FemDOS");
    create_file(1, "file1", "b", "PRINT \"Hello,world\"");
    create_file(1, "python1", "fc", "print 1 + 10 * 10\nprint 10 + 10\ntest = 10\ntest2 = 20\nprint test\nprint test2");
    create_file(1, "loop_test_1", "fc", "do\nprint 10\nrepeat 10");
    create_file(1, "loop_test_2", "fc", "do\nprint 10\nrepeat 0\ndo\nprint 5\nrepeat 10");
    create_file(1, "if_test_1", "fc", "if 10 == 10\nprint 10\nend\nif 10 == 5\nprint 5\nend");
    create_file(1, "color_test_1", "fc", "color 1 1");
    create_file(1, "color_test_2", "fc", "color 11 11\nprint true\ncolor 13 13\nprint true\ncolor 15 15\nprint true\ncolor 13 13\nprint true\ncolor 11 11\nprint true\ncolor 15 0");

    create_file(1, "basic", "b", "
    PRINT \"loops\"
    PRINT \"are\"
    PRINT \"amazing\"

    DO
    PRINT TRUE
    PRINT FALSE
    LOOP
    PRINT TRUE
    ");

    create_file(1, "asm", "a", "
    section .data
    hello db \"Hello,World!\", 0
    section .text
    global _start
    _start:

    mov eax, 4
    mov ebx, 1
    mov ecx, hello
    mov edx, 13
    int 0x80

    mov eax, 1
    xor ebx, ebx
    int 0x80
    ");

    create_file(1, "smiley", "img", "005006255255255255255255255255255255255255255255255255255255000000000000000000000000000255255255000000000255255255255255255255255255000000000255255255255255255255255255255255255255255255255255255000000000255255255000000000255255255255255255000000000255255255000000000255255255");
    create_file(1, "background", "img", "050100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000027096046022085038016049026025071035029083041024066032023066030037092043037101048026079040024044026039040030046048033057051034036049033035062036053089044055091041036061032033069034036085038038081043052058038105081050187124069111076041099080048102094046073103046037045030030038023033061036022028023076047032177103052112075042041040027052039030038031026042032030072064042117104061095069047078074069106095088080073063078070066091083079063056051054050037023063033018052030012040025017052028021053029024062032038089040040106045028077038020054029029044029029047031038053035048048034043056036037058034051057037075087041102124049096124052102140056095118057065071043105085049178111057229153068241166082190147063153151061115123053052072040028056034065049032149092055097060040039044028036044028037027024038030024084058040115078053085064045072054040066052038047038033051050041045047036058050040068067047057062039018047027013046027021057030038083044026063034030073035036084038036086041032078039025060035037058034037065039030048035037054033038055029034061033035052034046040030077082036107137057108132052070076040057060038065057040126088049201144072155111060132090050147101053134103050062059033034059034087062042116078049046034025039029023039031023037029023083057040114074053080058044071054041076058043051040031033029025030027022045044035066059041050052032033031025017054029016044028050101049065133065040081042027058025034066031036063035037075036039076041047093046038076039043060038043050031032040027036056037041061039054050035059054035057058039058047038054047037058052039041037031069064042078071048043039030042039029039036028030024025039023021056054033076071046047049034033051031040045032037026023085059043118079053084062045043038028042037029046038032043038031046041032055048036069057042051040029030021022031030028031079040027062033043083042055108049043082039033046027037061036038064034045066038047075044046088046043066039045049036040051032028033022038047031045061037057051036051041034056047036061050040058049034055046037042040028076073047059054040040035028047042033033030022038029025052036030090062047063045036032053031042088043039053031076051040119082054094066047053044033048044029040034028046034031038033028056052038066054038041035027023020017040047036070101074052107050053102050063117057057109052054103049033060032032054030043059041040040032054045036056056040064083053069068050040050029037045029070063046068066043063058041052043034074061044106079056108080055035034031075062043106084056099073051108076051077057043031025022040028024082056045076057043037055034038078040035059033065052039107072050087061046074057042080061045067050038037029024035027025062050036064049036035028024025019020047069054070099071058058041028070032052109049057115053033076038033073037035075036030068034026053035028054034033040029056048038074073047067062040037048027044048033076063047096077050072059041078061042067054042070055044079063048044040033147112069119090056088065045124084053142080052054030025063046037085062047044037028038058034044085045052080044088068046086067046040042035036036028037031025035034029050042031061046034057047034028023019030031027066091073081096070061050036069052036042091043059113053043095046033081040037073036045085045029058031027046031031070038027057031052073044081078052073067043035041028056053040086078053099083054067056041103079054116086059064052038030028026069060042089077049045039029044041029041037032118047026105049029085060042053037031029023022042048033061071041094082051083064044049064037051068045047043036035026025053051039068064045048040030024019017034047038061093074070078056071051036072058040069058041046092045027060029032067035033071039042083044033062032035067032034064035033071037043082042049068042072063046066056040047043035065057043074065047064057041056046039060048040063051039057048037069057041145112064133096056126084051125085053033026026110049027228130060121077047030039033024028024059045034109076052093065046049038027045041028042037027041032025050039030062050037043033026024020019048070055088107076084070049084060040090070047074057038060047036029068033034085043038087041037077038043082043054104050060110051047075040044074039045079041049072044079073050067060044031039024074067047088079053069064049066055043110086067081065048047041036075063045125096059130088055162111060179113065076036027097063045171104055063041031028040032048040027100068045096064047078059039080060043051038026040033026062049038064051040034027022027030025061084062091098070138098059131092059135099065124089059128088057142098063032075039041083043043099052029069034035070036053119049042090042040053035041052034037053034061062040081066048058060039040057030075064049080067047062049041059049042067056045060052039057050039097082052066054040051040032050042035060031020138066035086059041092061044069050037035026022102070048101074049073055039061046035047039031045034027059045036064050039029022019035046035071105073076080053068048033065051035068054038076058042071054037088065046101072047028060030036063036035078041032076036034084042059099052059093053040066035029053031033057034072069048097087062059066041047063034091083059087081057067055044063052045061052043047041034094079053122098063050042032043036030034028027043027023181108060131082049079054041056040029097068048098068047060046038069054039054040034040033026071055041053041031025023017053066048079101070089075053096066045095070045131090058127088055114082052117083053129088058124087053032069034022045026025060028036091044067108061111144078099133076075104056054054036043055031069070048094085061051063037051060036094085062080074052061051040062054046063053043049043033084077054064052037062050038074051039042026023078056037071050036049037030031025023087059045099068048076058041058045037027023022057045032068054035044032027031032023063082053098100068138098058176124068188131069177121068189128074188128070194133071198134072204137073203137071031070039046105050035080040027065033061095050110133076102137072095129070072067046053047035072069049095087061046055034059062041097089061074068049057048037063056042056048037071062044080071048045038031046042035064036028076046031105077046067061039034030028077051038105073054082062044051042028061044030104074046059051039052041028045045034087095063154121065181119059188129070194135066195133064193130064190129070195131068200134068198131068197132069203137070040090042033075040047105050046102050036081039056080041077095054078079053066055042056048037073068051088081056043049034069064044097084059066058044058049038061050040053044038087078053058050038055044035033029028073046031160100060074074046069071040158101052156102059078058041066050035088061039175117064132089048054042027093079053138119072184130066205134067204136072191132069192131065200136070193133071187130066203138070207139067206136072208141072201134066038083041049100047037078040044088046045074041040062034057057040064053040063054041059050039076069051091080056051045036082072051092080055056049039062054043052044037072066046082071046053042037051040034036025024081057041092065043033041028130085042230147070105075045061051034082055039189124072126080043077053029167131082200144080197129066207140072202138070200136068201140068205142073194133066202137067192131066157108063117081047169112061191123066199127069059108047053113048059103048059104047050097047058063041065054038063054040067056043059048039076063046086072049057048038078065049075063045057051038063053041057047037086076054069057042052045038032025024070047037074057040025023021055039029126085053092064040054059037048044031141094061114071040107068038176139092150113069142095051135095058122089058111081049112080049126090053125088049096069041097069043097069040087063044057044033082060037119075045152091049076124053042098043064116053056105047031071040049057039065052041062051041071058045064053042079065049081064046055047037088067050066052040067057044060053041072064046085071055059050040047035029049034031079056045034028022048036028105072054081060045061047037048045032066051036052036025084068043171135087122090057083063041070053043063053039061051038093070050093070048118087055142096055143097055109078045075058036083061041059046036052040028055035026096061034032071036045091040043092042036082041024056031035065034041062036060055043064053045061051041080066046066068044059062040087071050065058041066057044061049041086076052068059042052044034048030023092062048090063047043031024096068049086066044070056039055043034064047036045038027043050039083075056080061041075059039083064043078060040080062041085062040094069044092069043086060038102070043118079045134087048136087051079053036041031024051040031125089054199137070042087039062110047069111053022048028029066035039100046038087041043055037050044035056055040077071047054069041065070046076065043070062041066055043072061046086073051058050037039035027107068041100073050086061042140092058097070052074057040057045035065048039047036027049053041076067054099066048131092054141101056154106058161108061169118069172117065193132067191129065177121059172111057177114062135079045116068037088061043104079057164115066155098052118067035052100045076122059050089044023055030027067033033082041036077042035051035045048036049050036088071049069056042086070050076065042067057044069057044077071048062070044050056037060048036093071047040047031084061045112077049071055040060048036063048038039039032066062045118089056134095058164115066189129067188128069199136072200140071208146073205138071201133063191124063179111058133080038116070037143099053186129073185128077142086051120069035121078041161112064056091047062100053026059029032069036031062032032078037027062033034058031046079042037061033077076046096077050109081048110086050114088059088069049077071051063069043050054036087061047043043031073062039111077051090068043086063039065048036050045035103083053176127068200140074197138075204143077199139071198139077207146077212147077204138067184121061156099051139086045126079043159111060184129069165107052158096049172111061153111052171142053196174056185141061028065031019052026024058028061103052065108056052096044039083037047098042066119045075118041140144059193148069195138069192140078190140081178135081164122069162113064140092054150107055158109052173118070182126068161103053144095056123095063146116068197139073203142069204146076203147076202144073203142076205146080198137066184122061148091048130080043137092051164113065180124067158102053134080042141090050176126071191143072199172062196181059200169076194146074040082041034070033030071033047090043068109052054100042056106044091135053123158055155188057171177056208156072206156073197146078192139080225167093202139073192131066204135069184122055225154077188134073174112056157099054169127078202150083213157084212159087210158086211159086211159084212157081204145076186123063154097050125077041140093053166113063167111059146091046136087045157110063185135083196143086202147082206153081203151083201143082191144076173163062045094043051102045053103048041081038054101045059116044059111041110143052151176060126158058132152059159157054179160061189147069215164097221162092192133070206141076169116054208142070200144079170113060165104058170144073190160069192152063184155072191149078195147081209155084213159082188132066162102049148092048143099054161106060154098056144092049151104059177129078196147085207155088200163075203175069199156066188145065178149056194167057180151055185169054060117051062123052062119052042096043057113043103144051120158055135174064118153057065107049084123046134168049163179051174157062216170096202154075206147079195134066183140051195148066178121057169109063179154067186181036194171051187169065151163056135146048144145050167156058174129051149095044161109056163105056154098052152102054173121068192144078205162077206172062205179058199171062180170054178185053193194041188181043190190050212217046212217039207218040044088037053112048047103043068120049076129046137173066164193070130168061055103041038081036081120044129168054116161038145162051218185079200165053209153067196142056213158070189139058168107065184148073200193035178180039179170064155166051150176048155177050156181043146148046164120057167118064155103053159117056178145066178158066199171069213190059218206052221216034219216029216208033203199042208203051219219042209213042175192049179194053175191049149172049034078036032077037073117050113158061115158061105151052103146053070117042083127047128163056108151052103147047100146044139156055171175058167171048172165048194181051201174055176129054180151069191174058182163051163173041164181044144173044143163046154157054167166051162143059166131062166138065179157069181180060166175050181181080162175066156174051161178048166182050164186044153174038149166044146166049129156047121146053111144047144174055153180053156184054037082038044089040061113045072124048095139052057108035082131049100142054111153055144181062128166057139168060124156052067116038077119045079123043072104043085096048088091043097089049113117053103103047093092049102108049109106040127111045141121056158129056140119052143146056169168056187178061186178058170180050162182056184186089166185065147175055134163054112151046097145042080134032094133046114150061084126042071111040139170062155185056148178050143178049052089042062108048101146056117158058101149056083133051096140051138172057151181063131164058119148051124148051076108041052093037040087036043088039038073038047058039044056043044056041049058046049057046048056042044051043051055042071065048082077048099090052073083045081099044083088044125125059155163064141152059139157055156181051174197057180197061150176055143173052137172054124163047090133036131162060112156050069124023112160044153185055140176046141177046081120054070120048112160056117158059096140054088125053082122052147173065145172061131166057110136045101125047100105049077096050032064033037065032032050033041051041041049040039048040037047037034044036039049040041053043043056044042057044039055039034050036036046036036046037037050039040056039059073047045068042088120049139170052140172051151176056169191060152177055141164056088129039112155047147182053131170050128171048160185063165185059142173054155186053077123049082129047114153064061107044098135056037079038063108048118155060093137050092129054065097045075094047055067044028045030031051036029045033028041033030041037030042034032045034035046039036048039033045038038048038043058043041056043041055039041057039040059037039057038036056037030049040028051037036064038063093048087121051086129041107143048138169055120159048132154067125150053130167050148179060161186066142180054146172063103141046135167053137168047065114036078122048069111045057103047070103051045081039063098044119138051070105042093118053067108052070095049041048037025037031029044034032044034050064042060076047061073047058070045050063044056063044070080048090107047088115049081116046106136053104130055099123055060084046036061039030055034033060039033055035032049035033050031046068037083125050088134040092141034117156047122158047139163057157170075184191092158182064131162057056102035083121044113148053066110041054102038061109045062114052030068034063066040100084052132140058064108047088118054075112053070088050043049038027037032029037032050066043102143067090134061098122065109118071113119067123124066150161056163186053158189057151187051145178050140171052127149059085099051047074042032062036033065040031048037025041031035059038043078034074109042082118042132170054167195058170199050151182052116149051140163060135169053095137045096131049075110044063097041055096044065113048067120053038076038023049030059063042107082059113097058055084045042074042046061037051054039049054040024035031027036030052077045071122061036085056030082058042088062055091069055087069069112058110153059128170062154190056162190054136175053106151054104113057069086045032061037039068043031048038023040033068093047106153047092137048070111037105143046116157045124161046150184053118155048121151054129154055112141054085127045060098039070110046048089039053104046039080042022045032024042031037049035048054039055064042038051034040047034037046034057059040054056039024035028029039028039068044045095064035088061039095064036086066054097074086114081104133080128170074104151066105152061119163059106151058108158059120130059074078048035056042052064047031047036024041033066088046122154054108145047124160054117156046107149045080126036066110032074119035073114038092124047140155065068110037047087032063099037049088038025056030022046030024042032024041030023040031020040027024051032026042030041048037040048037055059041052056041024038032029042029032059042034084063039101065035091064033085062078125084139181100118161088110156078143186076103150063095142063095139060076127056129126064092082049028049038044054041029043033030047036027046034081100049135169048113150041135171048103146043086132039074123037083128037105144046097141047071114034060100032064109035099136043054096041040068035025046032022048032026059035030056034029055034025042032029048031038059038036049033054054036053053039025039032036035027040059045038094067038092060037090064037092065082134086096151092073127089075127087096146080087132073079129061098152059089139059104107056083080045023044034029041033030042033027039031031047036025044035087114049138170053118152047124158046124160047150180057131166049100142037106139045086121042089123042108143051133166054029057032023049030024039031023041030026053031031061031026057035027050033029049031035073038040072037067062040057056039021034031039034028045057044039097066045112066037096065046097070074131088062120094062115091082131089078124088067118078137181072113165060126161062143117062080078048023045034029043032031042032028040031031047035024042034033055036073096049089114053120149054137163053178202055149185044118164037132164052125151053140162060115139056086127044022044030022046030022048031024039031029056033030066034025063037024055032029062034042072037051069041070071045065059041023032031027036029035062044046112067040100064038088067065120090076132097060116096056116095084137089081122084057106077124169074159200072118158058157129064103091050019041031029046033030047033026039031028045035029044034038062038027048033059085037137165058142165056159185053173203053164196054105146041127145049131148058077102040073118044027050034028054034022052029025050027035076037030077037027063035028054035027048033041058037056062041078071048068062041023032029027034027028062043040105070039087061072126087087143103088141101063121091055110096072125089076120086058108081062116065111154061127177063129134058104089052023039031031047034030048035028039031028048037026042032036064035027048033056078043105128052121151054108128046178164053137173050102148040134128053093093052068090043063111034028054029021046028024048029029059030033067032037086037036072033029056037029051037032057033050065039071060041061055039028039032028036028034064043038090063040088063066122082100156100115164101089143087063118092052108088061113081051104080071121061066114049054108048125125057094079050022040031032052036028045034029047034030055036026042032032058036032060036037059039042065040073106050099131041131131042107142044100147037129123046081072044072096040128163053025055030026076031031071039030064036032073034038088033038075034031061038030056040041047035060059039048052038047054039026039031028038031046079049059114065044094063043095067119169095138186097092147088067125090057113084059110075044097066035084049052101048069118051126125058083072046024043032036050036031048033027047034031055037031054036030049034037070040037063038044070041075106050156181059141173051143179057160193052171162068200162101161157076104142041024051031030074038025060034032077039038092038035089031037073033038067035027054038040046035065059040058067045055061039030043031027037028049082049065122066054105059046093059128174085168213094116164088075134082065116069050096057035081048030075045050098046105152058133133054072066040025042031033044035032046035031048032032052037027049035026043034031060038039064039040068038035063037116137052174163051169155055153175052180171076244204133209193106102146041022045026019040027021046028033079036038090037037083032030050030034053034028053033038057033061059039058057039061060040031044032025034026051082045079134063097148069040088056087139075159204088133179082115163077122167076071121053050098047030074046066110052133177060128142056051054040027039032031041032030043032025038029029043033029050037030054037031058036040069043040064035034059032089099046192146054158095041149118042188151075232197130193178100075111042022045025023049028032068037034074036034073036034059033030044031029040031032061033036077035052066038064059041066059038024036027023031025046069043096148067083131063054101059073125074135182085159194080139179071103152064085137058052099048049089049051095051107152058113131057032043037029043034027040032026039032024037030025035029031043033033060040031055037036059040040065036036061033113084043207122054161104047156098048173116062131090053092090045034080037024048030026057031029059030026044031026047035028046034028041031031047035029055035037059035053061041072065045060056037025036027022031025036055036054108061058107061059106060063119067129180081171203080112160065053107048047096048041082045039080044063106053065105052059077049027038033031041031027040030024034032024033032027037031028037032033050038030050032042060039042064039035057033156100056200120056150096047190119058192127066094061039088093038092144044031078036033080036029068033031059036026054036028059041024046030029055037027059039038047034065058040083069044061056038028040031025034029025036028032068046047104066041089055058110058101154072139180074140175068089141055055106049052100051044092047089134056100137054030041036027036031027036029026039029027038027024033028025033032024033030029039031024032029030043029037056038039048035158104054173108052136089047170113060179121066089061038112115042146188058035085036041094040040098035063116047053095044031063035027045030029051034027059037034058040067063041095075045076065044027041032022032026027040031029041030036079052067121061090139062069122065078128066132161070123170060097145058077123054123164055104141056047067040025035030030041033025036029026039030026036027026035029025035031020030030027038031023033028025036027029055035050063037151099055160100049161102049206132058182124062095061038102104043115164051044088037077129053092147056085135052111156070069107051026047027030054037030052036032054036059066041085079045081068044020032027021034026022034030029040033025040030072104052089137059065124069092152076125160069145182059122170053095142056103133053049069036022032031029039030026040029026038029030043034021031027025034027023034030022034031025037032017029025021034026030060037059068038104073037163105050151097049171110055150107057086063039088108044099144046093144054064103045066102049095132060072111049038077040026050032029057038033054038037054035062067040086078047092071046026031028024034029020029027030040031027037029023035027034050034047080047073112058078103054077097043086115044052073040031038035025034030026035031027036030024035031023034031024036032017028028028038030022030033026035030025034030019028027030040032031063035071069042151094048186116058158105052213139061146111054118144044139175049103152038076115047046082045017042032030054032029064034028065036029076039028072040029050036032054035066060038095079044099077046038042034020030029023032030026034031035042033030036034026031031027032026027034028030039034031039032036043035037044040031040034025035027027036032025035030029040031031040034017025032021032033023036029018029032025034028029035031025034031038049039031058032102079042185113053188117058157105053163112055156113063141149055163196059122167040020055029024058034028066036027060032021044033020045030030065034033063036034079040032076037055059037087071043083075043049053035019027028023034027023031029027036029035044036031040033027037029028038033032041033028038029030040032029040034026036033024035030025035029025035032027036029018030025018029028024036029018030029018029029024034030023031028028033030035047035033051032149094048208124056190121058195128061130092049148100057121087046143167058159191046061101045035080037033074037026058035026051036032075040032079041036083042037092045036083042042055038086067043097079048078068041026035032017030030025037030020032028024037030030041030027039031029041033029042033022035030022032031024031033026034033026036034025035030022032032017027028021032029022035027018031027016027028023032030018029029019031031031041034030043034070060037183111057170105052163109056170114058104076040141100055113072043126135050173206052048095039035083037030072033023049031026051037029067037031070038032060037036066038038087045040082041083073047105080049098077045051049035019028031017030031021034028018030029020028031024033030023034030028040033021033030019030027020031032022033029024034030016029029016028028023035033027037032019029030016027031021032030023032029014026031024034032039045031034049037143095050220134062155098047157105053104084044081065037146104058106070046118119045163196053104150052114161057086130051037077037029068036028068036029062034036049033036048035042069039048080040067065039092076045093080046080067043032038029018028028023032032024034032020030029018027027022031027029038032017028028019029029022032033021030030021031030018029030025034030025034030018030028019028030022032031024033028015026029017027030037043036035042036076059036207127060175110053161105056156108059079092045078069040127094053081056035123125050152185058122163060094134052070107046034076040044097047034088042034073037039048033040047035046058036056054038071059044080066043081080046089077046065054038029037031023034033023033032020028027020028031023032028028038031021030028021029029023030034024031034023034029020032029017028032013026025019027026026034031023031027020028027018029030036040037042044037045045031151096048206126061154099049165112059116088051083110052076071042108081054086063042089087046080114047071111044044077038020046032025052033027056032032065034032054032039061034042069034050060036058057035065065043049067038077069040105075047104079049055050035029037029019031029018028027018028032019029027024035030018028030017027026022030031026032032020030029014026026018029029023032030025033028023032029020029028020031028030038034057069044052056039127086048191121060122085043139096051145102058088073041080096048068067039147107064140098057105101053082121054031051031030054032028059033031058035030055033032065029034064033039073031048069034052068039052072036061072037056080043056080041096075048108079048101078051054051033034039032023033030016026029022029029026035033020029032019028027035043035047057042039048039018028026024029030021028032015025032019031026031038030033041033033039031084103053103100049138091051131091051088071037113086051094070045062063038058081036060072037148106063114075040104104051107139064032050034035058033034065032033060033030056032057091040084119054044064033048049036060067037056071035062065038078065043077074042075069042097076050107078048098074045058053036037043033032038032028036031028035031017026027015026024030040030042055039034043035016025027017030030021031030027035030032041031038043035040041034062067041127152065102091045100072044092072042076066039097075045084065042063064041053079040054072039144109066112077045085090046087117057026054030042070035038069035046083038089126051106142063052084043034047033038056037053058036056058038063061040060072042062069042062067041077069043095074048101077047102078048072064042046047036043048036058065047042047038041047036033039030032039030037043035036041033033038029034036032035036031041043033040042030056050035095082048113139059091094045079064038067059039068062038079068044068061042055062037043083039050072037144103062101071042086090050077091047065108038064103046068105049104142058130170064086120056022056032033056034036061031046053037053062039070065040072071044068069042072070041077073044072069044085077051099076050091075047087074044070066044071074050079079056060065048054064048053063045054062042045051035043047033056058043076075058058055038083067044108082052096074043113140061083096048069060042063058040071064042084071046062062039048072039040082038052069038143101062100072046057057038053055038074109045041070036056090046111147061122167061046092041022058032029062032040077037042069036046065033062061040070066042068064042063064042060069041055065039046079041066088045080076045091077046085075048077073049080078048087085055083080049088085050096090057089072047088081052107094058126110074092077049110081052103077048079075045119148068090097051063053041067061042066063042067061038056068038045070041038082038062070040114084057077058039060055037073080041027055033031060033044074038058098041073124048049104040070120046081122052053083044038063035050067038060061045062063044061061042062066043053066037051062038047069040045081040044075040059062038075068045074074047074073044072076043093091050078083044083071046094079048107087053103077050097073043095076048077070044070063044047054036079107052096106053061054036068062042071061042060064039061065042051066038043082042066068043140107066131098063096074049099113054040070038056086042068100048040084035048097040072118048068116048068103050031058032036070033044054037057058038055056039067064042067060040058055040057056040053056040051055039042058037047056041049066041048068038046064038054078041057079040069086049078082052060076046072078045062078044059077045051073041042065036043062038054068039075106044063082038055054037058057038058057038066069045055055037046054035046058036055054038151109060133095052080065044079084049052087039097135059118155064078118046052089043030067038038072036065099050054099042053092041079098050063064043054060039068066043062059042056054039057056040039047037047057039040052032044050038048067038053067040044056036045067039043066038046073038068096054052081043037068036038071039037077039041077037041067038037062034048063040062097042050071034053061040062078047048052036066070048056070040079108049048069033048051036144104059103074042060055038047050039108150056124165056108153056079130050051100039056096047094132058114153068078127054085130054092112055050053038045054038052056040053056040050053038048049038046062042055070039041054037041047037046068039045065037041045034041049039039051039043061034044056034060073044051059038037054036042063036041059037040051035036041034040057037073112053049069040044057037051079043047056037057069043088114056091125054034056029040052034141106063102071046062057040045050036090128054107147057055097039028071028049097038090136058085132057064121047046104044047071040034042032038046035036043034041049039036047035039046035040043037064087050056080042029039033034039034044063038042063040033041034032040031039046035037044034036040031036042034048056041043051038031041032034044033031039032045059035066094045084123054051074039059076042061097042042058033055069042075100045107145056043081033042078038133105060094068045053047032035038031043078038047083034051088036049089038040083037036084034051104042036092035037078036030038030031039033030036033032040033028037030029039034029040035029038030060082047089126057077111046052081039066100048047069040026037029046068038042068035031047038030039035025035031025036030051059041050056039032043034032043034077104051100138056090129053069104043059093042069105046040049035062082047054092039115159060049102038039062034099077050072058041056057041037055034075113055101140061087127055044081038045088038043091038062114045043087035038063035032043032039047035057074043047057037038045033050052036061070043066080045065087047081116054091133051102146058093130058064098041081116051079106048068087045068071048071061045070062045070060046073080046095106052084098051082107048076103050072110047104144055096134052063103044067112048052070046077102049073111046112156058049101039042076036133111066120087057079100051046097042049081043056089040068106042063105041068116039095139050077129050047093042054060046063064046074072047095116052076080047099086056123098055120110056109111058084109050099138059098142057109153057112143057110134060102125055100107047098095050111092050126116057105098050098097052088110052089102046104121057094121052096130050090126051093131052107149056077122044068113044057096043089130054088125053094135051052102043041094039152124063102067040073104043074122050029060034045077039073116042122165054149189058118167050064117041049101037076110047100115053103118054094128050095099047120100053133109054136127057112139054120148056114142048131153057135134056128129057133121064125106056136133063134116055127130057130161059130160059137168060137168062131163060141174067138169063152185066130166057113151053145183061123166050099149048093137049096143053117157055129164064073119047060111042159131068093060037096120054098136055043076033044080037088131047134177052140181043129175047100147047097147050124173060143175065151172065137177064144173076161181083156162080168174071157191058151182060180195071149179060132164058134163059102129049105110053060102044098134054123159063133164065120146059138161064142168065150161070114131055133154062159182070148175063162183068151182061163195063147183057125172051127166054147181065147178066124162064132170063175144067091062040083104044107146053086126054098140056132172052168207047166203044171206053127160053111147056114155048128165058141172069150182079155182086132170083113139072129145070151182080143171079120157069139170072150178070172195071143167064129142061096134053108141061147177068104135056071095045074093048064096051088085052061064042069086045129162061134166062124157060123163055171201065187209069173202067142175060113148058105136050117151062097128054158128065087063037104128056084125048063096046054101039102152047161197050181212052171201053080115040141176061165203068132179070081141082079142091137182098149192099135166086096130076089152085110166087087152078126179066113163053128173057156181070141157061132173063132166069117151060062107046040085044042080043037072036079081050054060040053066040080094051085105048131153065129158058135166057131165056143171072102137056079117048063094044049081039057085045139114070083061037051070037058092045028060036026063033037082038083120053133170063133171061074112045064109041122160067133167081090143089075128092082130088108150088160174088133149079113152079092140078111151075161184074144171063103137052109135054119132062106133058105126054080101053071094049071101049073098052068091047079078045073074043072075048068070049069072047062076043089108057139166064147181063130165067137169066122161065061101050046083043058091043120104057121091061103115056075118041017050034029067036056095050069109054076120055041091038036082040032077037074119066087136085074118074080122080080131091078131087094139085139178092163197096144181091111159085131172077166198068103145053084131050121159065118157064068109040057096046050093042039081038036071036041091045036068039033058033034059036034058035039072040034069037051082045128165063135179057071127041060109039078121051042089041040093044052104044124106056120088054133142063147183059030062037023058031049099051068122063048100047025074035041088044073124072056106055053106057048105059061126085071138093069136090062132089075140089152197102165203098156197096149196081114165055086140044065121043142184067136176074093134054068115047052102047040084042036075039040084047037072041035059037037060037035062033039078042043084046033066035077108050106145058099148054077125052056106048035087037038085039042084038108096056089068040111134046142177056031078037024071034022077035030086041034086042038094048061120064072135085070130086078139089077143091078144094109162094091150091069137088062129089078135088160199095155196093160200079155196067115168052082136043136182060139180071125163066067114046065111049061104047037074039038080039038084043033060037034059037053086045042085043046096046040083042031069036070112047133173065109153061066126053041087041029059033041061038094082053087064043138154055167199052028080040024080038036093051043094048033087041040094049037087044037089040067122069070126066101160093104163094144190102125175101073136088066130090062125092100154092111165091084145083143186071161201061130173055129173057161198068116155061079125048076124053065108047048083041035064036039070039034066035031059035050084046060110050046096042038081043041072040115151061128176058096149055055110046035065037026048031052069046104094067084063035134147063105140054032089045044098050051106058032084042029082034031084039036088037073121055125170085112160081128178098139184101152192106128176101072137087073136088081143088060125082063126083072131084158193069180213065166206066138182056166198064149186065110153055071120048062108047062100047043073041046074039064106049047090039047094043035080040037079042037073040039076041078119052096138054080124050058089044036061036024053030052070043130114081076057037065087041047089043032080042051110056050101052031086046066127070078146088070134076087137077125173099132183103134183105115168097132183103121173096088146089117168098092151088062125085073135086080138090093145081163200065165204051163203058177207067147183061145180073095138053058108044041088042058095044050093040106153060129181066097155051065121049043091046039078041034070035040080044056097048028058033032059034056079046034063036059079046129115083116088061080096050049097046034069035051097051073124079075128073077138082114178117097160106081150102080147098120173103136184105097156093115167096163202104139184099132180097078139085090147090073136084059124084067124082156190074180209062193219062169203058110158046078127046066112045060102050116155059125166056064112048076119053110154064082133056059115048041092045031065036030054029030056034033069035038075038033069036037067035054092050072102057126115080102075044076109050058110046022050032011044023050098048067118060055109063090148095125176108099165100070143094086150094155199108145189107085146092099155092106160089131176094104159088096155088091148091069131085066127080071129081070126080094142076123167073177206067142179055070121051056103042129167062172205066108153055038086038041085039056106049050103048049094046035068037030065034032071037032065034032065033036070039031067034037079040086112064107098066079060034101130050094147047022055032036088039064120062043088049041092052082132078139187108125177102094155096085146097110164100119171101070132089071137091127176099158197100115167088061130083066130083076139082064127083053118087061120083071126079083135070158185069170202062133177062102146050058110042146184068131172055091132053111157054087143049045102048047098044046098044042099047037080039033072039033069038029054033030055032022053031052082046100096062087067040140164057166205060034081040036086042038088046033079043026072039035085045049101051053104052120169096114162113092148111078143101081142098075139093106160097146189100102156088099157089112163090073132081051116082054120088077135079175204073147187060092146047084137044146182061168196070092141051088138048094135053084124052159198067103161046069122045036084038046105046048105047048099045035085040031077041031062036034065034023056031054077044119104069079061042084110037108162044019056031024057034030075035032093039046104046044099041072127061112157086129178096118172109105157112079139089118162123097153109069138090088147098094151086137183089146188092095151081080138084057122085067130082116164071181212065151193052095145039155189054183211064126164055067114037058110042052101040108146051136179056098150047062104047040082040038079042041084044042090044039085046032079044033076038027061034092101071122100061084064044092102050112164046018051031021050030030086038027076032033077040052101050084136068086137074053105049072124072057111061030080034069118070071131082061133086094151111150190146120169087117164086142184128119169094079136081062125083066126077168200068195221054178207053169202059128163053130166065138179055086139044077129044133165060181206066172205057099154050063118044053101043034077039031075038036081041050094046033078039027066036054077056088090061073064042128149059159191062053098052056110058040104044024064036022050034041075047038087047028083042042089047052096052042089042034082040030078039073130077076140088132176142200229208172208173172209177171208181104158079114166086061123080066124083120165072156188062182212051124171049049107037082128050189209080151184054083135041085135041149179069154190054094149047071136042068128047053104046033080041032075038060103048059101045058099057075091064083090064065072052097119050150179068063113056081142080071130075031069038014045028008042027043087050064113064038086047034082041063114058078133076088142082118171089109160099185214196189219199192220203193222203189219195151193152088141093059121078061123085076128083145185067169205052105158042095149043139173059170194069186212058152182057128172047099142047081130044099152048109161051073134046044093038041085042040089044079128052106156058097133073090097071155147103138134094087098060150181060040085045030066040034071039052105044044093047057113058058119057029085039068117062048100045106156087125176103118169091124174094151190147191219199189218196189217196188217194190218196199225206105153122060121081061125089105154093142178077143186060164204052170203047185209064157187063144177051163196054168195067116159046105148051096149050146189057094150050060115046047093037048092040098143057106160058101138068086095067165156115143138093096105065140166064017046031026061037057102047091152056048107045072131069086143073066122060103158089124170117115164100131178101118166114178210185194222204188218199187218197191219197189218196193221200164195172095142102064123083065123085065122083067118082124166071200223055181210041147186045176200064174199066167201048170198063122160050152189051116161045128176054099152046072132042086148051056108045074118049078131051059109049127133090156146107140139097125139089060091047026057034031068035059110046068128052041094040041093045056106054060111054085134086097141112077126087137176136109150115147179158155185167160195174173209191182212191185215191196222200123165134058118072082130087087130092072121088060116083095143077186213064179208055201227055168196059172193074188210067169206048153181060143180053115157046137178056143189053091147045069130045070128050048099044059102047037093040079118064132122086105107067079111057059100048012037026019041031036070038048104044048107042034086041037089041033086038031085038033083037040093046068111073115156122080129094058109071171200175208218189227230205192215195186217192112158122082134078083134086090139086074128079061116080082132088077131080094145074143180070096140061073123054155185066199223062153191049111155050070120038093132048115155053113155056089145049061118043045095040043095041041097043061108050082078045061058034057069043043090044022058036015044029017036028035073037034089039031083038036090038048102043055107044055108040065115066110148121101143110081130092094139102172192152239231203240240222187212190195221200145184158087142072112167082110160091100148099068118087072124086066121084054116081072126082110160065098144052170198075186210065174208051141178060077125047065110043103144052134179057100155054068123048051106045059114047083141057064112050060082042048072040056081044036088041054107045030076034026061033023051026035076034049107041027081035036086038036089038037088036041090040061117064040095045081128081084128088157171143237237220200214196179211187191216193185216191156193160130173129125166131129165137089132094076132078064123079058118081072127083143184077117157057128162057183205071159195050128170050088131045061116038105148054106160046065124037043087035046088038071122050109161061059110043031073033036078033035077037029075033028068036040086037038089036051111044048091040039075034030071037023059032029067038029073040040087038037089033078128073092136095164194166207221202157178157173196173185216193177211189186215196182209189083135095061126073082140075077136078069133075067126078059119081057118084090145082096142070096139057143178065138176055095152043083132043095140047164197061128167058115170048074130046050094041051094041063122048060116043054085043077085045054091038053093036008034027030070033039099041036092037034082034020057033028069037031076036034075039051096041072116054052103050083131091144173149111144120111145120097133104153186164186215195194216195192218192186220193114160126110157111144187146130180135096153093087145084074129088080134099063125086122168084119162069124168064124166063113165046156195061142175059191216056174198068141180057081140047055109046052099040037079035043073039044067037062070040045075034033072031024065034022064034022059038022055032026069034031085038036089041042090044034083041047095046068116060061114064067118076099135107113146116114143117097131101156188167182214192203219192206221193188216194200221198221230202180206175131173133157190159105156108079133089096151106056120080106156080141183075129169067115159058111160043105157045081139041101145048138171061131163061090141047069123044063111045044085038020056030013036022015039026015039026012034023")
}